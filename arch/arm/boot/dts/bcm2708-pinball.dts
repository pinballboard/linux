/dts-v1/;

/include/ "bcm2708-rpi-cm.dtsi"

/ {
	model = "Pinball Raspberry Pi Compute Module";

	clocks {
	can0_osc: can0_osc {
		compatible = "fixed-clock";
		#clock-cells = <0>;
		clock-frequency = <20000000>;
		};

	duart_clk: duart_clk {
		compatible = "fixed-clock";
		#clock-cells = <0>;
		clock-frequency = <14745600>;
		};
	};

	power_ctrl: power_ctrl {
		compatible = "gpio-poweroff";
		gpios = <&gpio 5 0>;	/* kill input */
		force;
	};

};

&uart0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart0_pins>;
};

&uart1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart1_pins>;
};

&gpio {
	uart0_pins: uart0 {
		brcm,pins = <36 37>;
		brcm,function = <6>; /* alt2 */
	};

	uart1_pins: uart1 {
		brcm,pins = <14 15>;
		brcm,function = <2>; /* alt5 */
	};	
	
	spi0_pins: spi0_pins {
		brcm,pins = <7 8 9 10 11>;
		brcm,function = <4>; /* alt0 */
	};

	i2c0_pins: i2c0 {
		brcm,pins = <0 1>;
		brcm,function = <4>;
	};

	i2c1_pins: i2c1 {
		brcm,pins = <2 3>;
		brcm,function = <4>;
	};

	i2s_pins: i2s {
		brcm,pins = <28 29 31>;
		brcm,function = <6>; /* alt2 */
	};
};

&spi0 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi0_pins>;

	can0: mcp2515@0 {
		compatible = "microchip,mcp2515";
		reg = <0>;
		clocks = <&can0_osc>;
		irq-gpio = <&gpio 33 0x2>;
		interrupts = <33 2>;
		interrupt-parent = <&gpio>;
		interrupt-controller;
		spi-max-frequency = <10000000>;
	};

	max3109: max3109@1 {
		compatible = "maxim,max3109";
		reg = <1>;
		clocks = <&duart_clk>;
		clock-names = "osc";
		irq-gpio = <&gpio 13 0x2>;
		interrupts = <13 2>;
		interrupt-parent = <&gpio>;
		interrupt-controller;
		gpio-controller;
		#gpio-cells = <2>;
		spi-max-frequency = <20000000>;
	};
};

&i2c0 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c0_pins>;
	clock-frequency = <100000>;

	pca9536@41 {
		compatible = "nxp,pca9536";
		reg = <0x41>;
		gpio-controller;
		#gpio-cells = <2>;
	};

	at24@50 {
		compatible = "at24,24c02";
		pagesize = <16>;
		reg = <0x50>;
	};

	rtc@68 {
		compatible = "dallas,ds3232";
		reg = <0x68>;
	};

	wm8804@3b {
		#sound-dai-cells = <0>;
		compatible = "wlf,wm8804";
		reg = <0x3b>;
	};
};

&i2c1 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c1_pins>;
	clock-frequency = <100000>;
};

&i2c2 {
	clock-frequency = <100000>;
};

&i2s {
	#sound-dai-cells = <0>;
	pinctrl-names = "default";
	pinctrl-0 = <&i2s_pins>;
};

&sound {
        compatible = "hifiberry,hifiberry-digi";
        i2s-controller = <&i2s>;
};

&leds {
	act_led: act {
		label = "led0";
		linux,default-trigger = "heartbeat";
		gpios = <&gpio 30 1>;
	};
};

/ {
	__overrides__ {
		uart0 = <&uart0>,"status";
		uart0_clkrate = <&clk_uart0>,"clock-frequency:0";
		uart1 = <&uart1>,"status";
		uart1_clkrate = <&clk_uart1>,"clock-frequency:0";
		i2s = <&i2s>,"status";
		spi = <&spi0>,"status";
		i2c0 = <&i2c0>,"status";
		i2c1 = <&i2c1>,"status";
		i2c2_iknowwhatimdoing = <&i2c2>,"status";
		i2c0_baudrate = <&i2c0>,"clock-frequency:0";
		i2c1_baudrate = <&i2c1>,"clock-frequency:0";
		i2c2_baudrate = <&i2c2>,"clock-frequency:0";
		core_freq = <&clk_core>,"clock-frequency:0";
		act_led_gpio = <&act_led>,"gpios:4";
		act_led_activelow = <&act_led>,"gpios:8";
		act_led_trigger = <&act_led>,"linux,default-trigger";
	};
};
